{% extends "base.html" %}
{% block content %}
<div class="card">
  <h2>ğŸ”’ Saved Passwords</h2>

  <!-- Add Password Form -->
  <form action="{{ url_for('add_password') }}" method="POST">
      <input type="text" name="website" placeholder="Website" required>
      <input type="text" name="password" id="password" placeholder="Password" required>
      <button type="button" onclick="document.getElementById('password').value='{{ generate_password() }}'">Generate</button>
      <button type="submit">Add</button>
  </form>

  <!-- Dashboard Buttons -->
  <div style="margin-top: 15px;">
      <a href="{{ url_for('view_passwords') }}" class="btn edit-btn">ğŸ‘ View All Passwords</a>
  </div>

  <!-- Search Bar -->
  <input type="text" id="search" placeholder="Search website..." onkeyup="filterTable()">

  <!-- Password Table -->
  <table id="passwordTable">
      <tr>
          <th>Website</th>
          <th>Password</th>
          <th>Actions</th>
      </tr>
      {% for pw in passwords %}
      <tr>
          <td>{{ pw.site }}</td>
          <td>{{ pw.password }}</td>
          <td>
              <a href="{{ url_for('edit_password', site=pw.site) }}" class="btn edit-btn">Edit</a>
              <form action="{{ url_for('delete_password', site=pw.site) }}" method="POST" style="display:inline;">
                  <button type="submit" class="btn delete-btn">Delete</button>
              </form>
              <button class="btn copy-btn" onclick="navigator.clipboard.writeText('{{ pw.password }}')">Copy</button>
          </td>
      </tr>
      {% endfor %}
  </table>
</div>

<script>
function filterTable() {
    let input = document.getElementById('search').value.toLowerCase();
    let rows = document.querySelectorAll('#passwordTable tr');
    rows.forEach((row, index) => {
        if(index === 0) return; // Skip header
        let site = row.cells[0].textContent.toLowerCase();
        row.style.display = site.includes(input) ? '' : 'none';
    });
}
</script>
{% endblock %}

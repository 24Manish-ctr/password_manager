{% extends "base.html" %}
{% block content %}
<h2>ðŸ”’ Saved Passwords</h2>

<form action="{{ url_for('add_password') }}" method="POST" class="password-form">
  <input type="text" name="website" placeholder="Website" required>
  <input type="text" name="password" id="password" placeholder="Password" required>
  <button type="button" onclick="fetch('{{ url_for('generate_pass') }}').then(r=>r.text()).then(p=>document.getElementById('password').value=p)">Generate</button>
  <button type="submit">Add</button>
</form>

<input type="text" id="search" placeholder="Search website..." onkeyup="filterTable()">

<table>
  <thead>
    <tr><th>Website</th><th>Password</th><th>Actions</th></tr>
  </thead>
  <tbody>
    {% for pw in passwords %}
    <tr>
      <td>{{ pw.site }}</td>
      <td>
        <span id="pw-{{ loop.index }}">{{ pw.password }}</span>
      </td>
      <td>
        <a href="{{ url_for('edit_password', site=pw.site) }}">Edit</a>
        <form action="{{ url_for('delete_password', site=pw.site) }}" method="POST" style="display:inline;">
          <button type="submit">Delete</button>
        </form>
        <button onclick="copyText('{{ pw.password|e }}')">Copy</button>
      </td>
    </tr>
    {% endfor %}
  </tbody>
</table>

<script>
function filterTable(){
  let q = document.getElementById('search').value.toLowerCase();
  document.querySelectorAll('table tbody tr').forEach(row=>{
    let site = row.cells[0].textContent.toLowerCase();
    row.style.display = site.includes(q)?'':'none';
  });
}
function copyText(t){
  navigator.clipboard.writeText(t).then(()=>alert('Copied')).catch(()=>alert('Copy failed'));
}
</script>
{% endblock %}
